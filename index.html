<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.5, user-scalable=yes">
    <title>Quiz Esame Trasporto Pubblico Lazio</title>
    <style>
        /* stili invariati ‚Äì identici alla versione mobile-friendly con account */
        * {
            box-sizing: border-box;
            font-family: 'Segoe UI', Roboto, system-ui, -apple-system, sans-serif;
            margin: 0;
            padding: 0;
        }
        body {
            background: linear-gradient(145deg, #f0f4f8 0%, #dde3e9 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 8px;
        }
        .app-wrapper {
            max-width: 1000px;
            width: 100%;
            background: rgba(255,255,255,0.7);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border-radius: max(24px, min(6vw, 48px));
            box-shadow: 0 20px 40px -12px rgba(0,20,30,0.4);
            padding: clamp(12px, 4vw, 24px);
            border: 1px solid rgba(255,255,255,0.8);
        }
        .page {
            transition: opacity 0.2s ease;
        }
        .hidden {
            display: none !important;
        }

        .hero-card {
            background: white;
            border-radius: max(28px, min(6vw, 48px));
            padding: clamp(24px, 7vw, 48px) clamp(16px, 5vw, 40px);
            text-align: center;
            box-shadow: 0 20px 35px -12px #0b2b4030;
            border: 1px solid #ffffff;
        }
        .hero-title {
            font-size: clamp(2.2rem, 10vw, 3.5rem);
            font-weight: 700;
            color: #0b2b40;
            letter-spacing: -0.02em;
            margin-bottom: 12px;
            line-height: 1.2;
        }
        .hero-sub {
            font-size: clamp(1.2rem, 5vw, 1.6rem);
            color: #2c4c6b;
            margin-bottom: 28px;
            font-weight: 300;
        }
        .badge-light {
            background: #c44536;
            color: white;
            padding: 10px 22px;
            border-radius: 60px;
            font-weight: 600;
            font-size: clamp(0.9rem, 4vw, 1.2rem);
            display: inline-block;
            margin-bottom: 24px;
        }
        .btn-large {
            background: #1d4e6f;
            border: none;
            color: white;
            font-size: clamp(1.5rem, 6vw, 2rem);
            font-weight: 600;
            padding: clamp(18px, 5vw, 24px) clamp(24px, 8vw, 60px);
            border-radius: 120px;
            cursor: pointer;
            box-shadow: 0 12px 22px -6px #1d4e6f;
            transition: transform 0.1s, box-shadow 0.1s;
            border: 1px solid #ffffff50;
            margin: 16px auto 0;
            width: 100%;
            max-width: 500px;
            display: block;
        }
        .btn-large:active {
            transform: scale(0.98);
            box-shadow: 0 8px 16px -4px #1d4e6f;
        }
        .btn-secondary {
            background: #e0e8f0;
            color: #1d3b4f;
            font-size: clamp(1.2rem, 5vw, 1.4rem);
            padding: 18px 28px;
            border-radius: 60px;
            border: none;
            font-weight: 600;
            cursor: pointer;
            box-shadow: 0 6px 12px rgba(0,0,0,0.05);
            width: 100%;
            max-width: 280px;
            margin: 8px auto;
        }

        .auth-form {
            max-width: 420px;
            margin: 16px auto 0;
            text-align: left;
        }
        .form-group {
            margin-bottom: 24px;
        }
        .form-group label {
            font-size: 1.2rem;
            font-weight: 600;
            color: #1d3b4f;
            display: block;
            margin-bottom: 8px;
            margin-left: 8px;
        }
        .form-group input {
            width: 100%;
            padding: 20px 24px;
            font-size: 1.2rem;
            background: #f1f7fd;
            border: 2px solid #cbd5e1;
            border-radius: 60px;
            outline: none;
            transition: 0.15s;
        }
        .form-group input:focus {
            border-color: #1d4e6f;
            background: #ffffff;
            box-shadow: 0 0 0 5px #1d4e6f20;
        }
        .auth-message {
            color: #c44536;
            font-size: 1.1rem;
            margin-top: 8px;
            text-align: center;
            font-weight: 500;
            min-height: 2em;
        }
        .auth-toggle {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-bottom: 24px;
        }
        .auth-toggle button {
            background: transparent;
            border: 2px solid #1d4e6f;
            padding: 12px 30px;
            border-radius: 60px;
            font-size: 1.2rem;
            font-weight: 600;
            color: #1d4e6f;
            cursor: pointer;
            flex: 0 1 auto;
        }
        .auth-toggle button.active {
            background: #1d4e6f;
            color: white;
        }
        .auth-panel {
            display: none;
        }
        .auth-panel.active {
            display: block;
        }
        .flex-row {
            display: flex;
            gap: 12px;
            justify-content: center;
            flex-wrap: wrap;
            flex-direction: column;
            align-items: center;
        }
        @media (min-width: 500px) {
            .flex-row {
                flex-direction: row;
            }
            .btn-secondary {
                width: auto;
                margin: 0;
            }
        }

        /* Quiz area */
        .quiz-page {
            background: white;
            border-radius: max(28px, min(6vw, 48px));
            padding: clamp(18px, 5vw, 28px);
            box-shadow: 0 18px 30px -8px rgba(0,20,30,0.2);
        }
        .progress-section {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: #eef2f6;
            border-radius: 120px;
            padding: 10px 16px;
            margin-bottom: 22px;
            font-weight: 600;
            font-size: clamp(0.9rem, 4vw, 1.1rem);
            gap: 8px;
            flex-wrap: wrap;
        }
        .badge {
            background: #1d4e6f;
            color: white;
            padding: 8px 18px;
            border-radius: 40px;
            font-size: 0.95rem;
            white-space: nowrap;
        }
        .question-card {
            background: #f9fcff;
            border-radius: 32px;
            padding: clamp(20px, 5vw, 32px);
        }
        .q-num {
            display: inline-block;
            background: #c44536;
            color: white;
            font-weight: 700;
            font-size: clamp(1rem, 4vw, 1.2rem);
            padding: 8px 24px;
            border-radius: 60px;
            margin-bottom: 18px;
        }
        .q-text {
            font-size: clamp(1.4rem, 6vw, 1.8rem);
            font-weight: 600;
            line-height: 1.3;
            color: #0b2b40;
            margin-bottom: 28px;
            word-break: break-word;
        }
        .options {
            display: flex;
            flex-direction: column;
            gap: 14px;
            margin-bottom: 32px;
        }
        .option {
            background: #f1f5f9;
            border-radius: 60px;
            padding: clamp(16px, 4vw, 20px) clamp(20px, 5vw, 28px);
            border: 2px solid transparent;
            cursor: pointer;
            font-size: clamp(1.1rem, 5vw, 1.3rem);
            font-weight: 500;
            color: #1d3b4f;
            transition: 0.1s;
            word-break: break-word;
            line-height: 1.4;
        }
        .option.selected {
            background: #cde0f0;
            border-color: #1d4e6f;
            font-weight: 600;
        }
        .option.correct-answer {
            background: #9fcfb4;
            border-color: #1f7a4c;
            color: #0b3823;
        }
        .option.wrong-answer {
            background: #f3cfcf;
            border-color: #b13e3e;
            color: #591010;
        }
        .feedback {
            font-size: clamp(1.1rem, 5vw, 1.3rem);
            padding: 18px 22px;
            border-radius: 50px;
            background: #fffacd;
            margin-top: 20px;
            border-left: 12px solid #d4a017;
            word-break: break-word;
        }
        .nav-buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 24px;
            gap: 12px;
            flex-wrap: wrap;
        }
        button {
            background: white;
            border: none;
            font-size: clamp(1.1rem, 5vw, 1.3rem);
            font-weight: 600;
            padding: 18px 14px;
            border-radius: 60px;
            cursor: pointer;
            box-shadow: 0 6px 12px rgba(0,0,0,0.05);
            border: 1px solid #cbd5e1;
            color: #1d3b4f;
            flex: 1 1 auto;
            min-width: 130px;
            transition: 0.1s;
        }
        button.primary-btn {
            background: #1d4e6f;
            color: white;
            border: none;
            box-shadow: 0 8px 16px -4px #1d4e6fa0;
        }
        button:active {
            transform: translateY(2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        button:disabled {
            opacity: 0.4;
            pointer-events: none;
        }
        .reset-btn {
            background: #f0f0f0;
        }
        .stats {
            background: #eef2f6;
            padding: 14px 18px;
            border-radius: 60px;
            margin-top: 24px;
            text-align: center;
            font-weight: 600;
            font-size: clamp(1rem, 4.5vw, 1.1rem);
        }
        .logout-link {
            text-align: right;
            margin-bottom: 14px;
        }
        .logout-link button {
            background: transparent;
            border: none;
            color: #7b3f32;
            text-decoration: underline;
            font-size: 1.1rem;
            padding: 8px 12px;
            box-shadow: none;
            min-width: auto;
        }
        @media (max-width: 450px) {
            .nav-buttons {
                flex-direction: column;
            }
            .nav-buttons button {
                width: 100%;
            }
            .progress-section {
                justify-content: center;
            }
            .btn-large {
                max-width: 100%;
            }
        }
        .footer-note {
            text-align: center;
            margin-top: 20px;
            color: #3a5e7a;
            font-size: 0.9rem;
        }
    </style>
</head>
<body>
<div class="app-wrapper">
    <!-- COVER PAGE -->
    <div id="cover-page" class="page">
        <div class="hero-card">
            <div class="badge-light">Legge Regione Lazio n¬∞58/1993</div>
            <div class="hero-title">Quiz esame<br>trasporto pubblico</div>
            <div class="hero-sub">Prova scritta ¬∑ art. 6 comma 3 L. 21/1992</div>
            <button class="btn-large" id="go-to-auth-btn">üëâ Accedi / Registrati</button>
            <div style="margin-top: 30px; color: #4b6b7f; font-size: 0.9rem;">
                <span>üáÆüáπ 55 domande da A, B, C, D, D bis ¬∑ ordine casuale</span>
            </div>
        </div>
    </div>

    <!-- AUTH PAGE (Login & Register) -->
    <div id="auth-page" class="page hidden">
        <div class="hero-card">
            <div style="font-size: 2.8rem; margin-bottom: 8px;">üîê</div>
            <h2 style="font-size: clamp(2rem, 8vw, 2.4rem); color: #0b2b40; margin-bottom: 6px;">Area riservata</h2>
            <p style="color: #3a5e7a; margin-bottom: 24px;">Registrati o accedi con le tue credenziali</p>

            <div class="auth-toggle">
                <button id="toggle-login" class="active">Accedi</button>
                <button id="toggle-register">Registrati</button>
            </div>

            <!-- Login panel -->
            <div id="login-panel" class="auth-panel active">
                <div class="auth-form">
                    <div class="form-group">
                        <label>Username</label>
                        <input type="text" id="login-username" placeholder="es. mario" autocomplete="off">
                    </div>
                    <div class="form-group">
                        <label>Password</label>
                        <input type="password" id="login-password" placeholder="¬∑¬∑¬∑¬∑¬∑¬∑">
                    </div>
                    <div id="login-message" class="auth-message"></div>
                    <div class="flex-row">
                        <button class="btn-secondary" id="back-from-login">‚Üê Indietro</button>
                        <button class="btn-large" id="login-btn" style="font-size: 1.5rem; padding: 16px 32px;">Entra</button>
                    </div>
                </div>
            </div>

            <!-- Register panel -->
            <div id="register-panel" class="auth-panel">
                <div class="auth-form">
                    <div class="form-group">
                        <label>Username</label>
                        <input type="text" id="reg-username" placeholder="scegli un username">
                    </div>
                    <div class="form-group">
                        <label>Password</label>
                        <input type="password" id="reg-password" placeholder="¬∑¬∑¬∑¬∑¬∑¬∑">
                    </div>
                    <div id="register-message" class="auth-message"></div>
                    <div class="flex-row">
                        <button class="btn-secondary" id="back-from-register">‚Üê Indietro</button>
                        <button class="btn-large" id="register-btn" style="font-size: 1.5rem; padding: 16px 32px;">Registrati</button>
                    </div>
                </div>
            </div>

            <div style="margin-top: 28px; font-size: 1rem; background: #eef5f9; padding: 12px; border-radius: 60px;">
                ‚ö° Gli account sono salvati nel browser (solo su questo dispositivo)
            </div>
        </div>
    </div>

    <!-- QUIZ PAGE -->
    <div id="quiz-page" class="page hidden">
        <div class="quiz-page">
            <div class="logout-link">
                <button id="logout-btn">‚Üê Esci (torna alla copertina)</button>
            </div>
            <div class="progress-section">
                <span>üìã Domande <span id="current-q-num">1</span> / <span id="total-q-count">0</span></span>
                <span class="badge" id="score-display">‚úÖ 0 / 0</span>
            </div>

            <div class="question-card" id="questionCard">
                <div class="q-num" id="q-code">A 01</div>
                <div class="q-text" id="q-text">Caricamento domande...</div>
                <div class="options" id="options-container"></div>
                <div class="feedback" id="feedback-area"></div>
            </div>

            <div class="nav-buttons">
                <button id="prevBtn" disabled>‚óÄ Precedente</button>
                <button id="nextBtn">Successiva ‚ñ∂</button>
            </div>
            <div style="display: flex; gap:12px; margin-top: 8px; flex-wrap: wrap;">
                <button id="checkBtn" class="primary-btn">üîç Verifica risposta</button>
                <button id="resetBtn" class="reset-btn">‚ü≤ Ricomincia</button>
            </div>

            <div class="stats" id="stats-message">
                Seleziona un'opzione e premi "Verifica"
            </div>
        </div>
        <div class="footer-note">
            üëâ Risposte ufficiali dai correttori del documento ¬∑ 55 domande mescolate
        </div>
    </div>
</div>

<script>
    (function() {
        // ------------------- ESTESO DATABASE DOMANDE (dal file originale) -------------------
        // Le risposte corrette (indice 0‚Äëbased) sono prese dalle tabelle alla fine di ogni sezione.
        const baseQuestions = [
            // Sezione A (pneumatici, freni, sterzo, fermata, velocit√†, etc.)
            { id: "A01", section: "A", number: 1, text: "Gli pneumatici con lesioni sui fianchi che interessano le tele:", options: ["Devono essere ricostruiti", "Costituiscono pericolo solo se utilizzati ad alta pressione", "Si devono sostituire"], correct: 2 },
            { id: "A02", section: "A", number: 2, text: "Gli pneumatici con lesioni sui fianchi che interessano le tele:", options: ["Devono essere ricostruiti", "Possono aver subito un urto contro uno spigolo vivo", "Possono essere usati a bassa velocit√†"], correct: 1 },
            { id: "A03", section: "A", number: 3, text: "Viaggiando con pneumatici dello stesso asse gonfiati a pressioni diverse:", options: ["Il veicolo 'tira' dalla parte dello pneumatico a minor pressione", "Il veicolo 'tira' dalla parte dello pneumatico pi√π gonfio", "Si affatica l'albero di trasmissione"], correct: 0 },
            { id: "A06", section: "A", number: 6, text: "Gli pneumatici dei veicoli con battistrada eccessivamente usurato:", options: ["Non condizionano la distanza di sicurezza", "Aumentano la probabilit√† di incidenti stradali", "Influiscono sulla stabilit√† del veicolo solo in curva"], correct: 1 },
            { id: "A08", section: "A", number: 8, text: "Gli pneumatici dei veicoli con battistrada con intagli profondi meno di 1.6 mm:", options: ["Devono essere sostituiti", "Non aumentano la probabilit√† di incidenti stradali", "Possono ancora essere utilizzati fino ad usura con intagli di almeno 0.6 mm di profondit√†"], correct: 0 },
            { id: "A11", section: "A", number: 11, text: "Con freni squilibrati, pu√≤ avvenire in frenata:", options: ["Lo spostamento del carico all'indietro", "Uno sbandamento trasversale", "Un consumo eccessivo del liquido del circuito frenante"], correct: 1 },
            { id: "A13", section: "A", number: 13, text: "Quale √® la definizione di navigazione da diporto?", options: ["Navigazione effettuata a scopi sportivi o ricreativi, senza perseguire finalit√† di lucro", "Navigazione effettuata a scopi esclusivamente sportivi", "Navigazione effettuata a scopi ricreativi senza alcuna finalit√† agonistica"], correct: 0 },
            { id: "A17", section: "A", number: 17, text: "Se lo sterzo si presenta pi√π duro del normale, pu√≤ dipendere:", options: ["Da sovraccarico dell'asse posteriore", "Dagli pneumatici anteriori sgonfi", "Dagli pneumatici anteriori troppo gonfi"], correct: 1 },
            { id: "A21", section: "A", number: 21, text: "Allorch√© ci accingiamo a scendere dall'autoveicolo dobbiamo tra l'altro:", options: ["Verificare, nella sosta davanti a un passo carrabile, che rimanga spazio sufficiente per l'accesso", "Lasciare sempre accese di notte le luci di posizione", "Prima di lasciare il veicolo in sosta, assicurarci di aver spento il motore"], correct: 2 },
            { id: "A24", section: "A", number: 24, text: "Il triangolo mobile di pericolo deve essere obbligatoriamente usato per segnalare il veicolo fermo in avaria:", options: ["Se l'ostacolo non √® visibile almeno a 150 m di distanza", "Su strada extraurbana di notte quando siano inefficienti le luci di posizione", "Solo di notte"], correct: 0 },
            { id: "A29", section: "A", number: 29, text: "La fermata del veicolo:", options: ["√à consentita, di norma, lungo il margine destro della carreggiata", "√à consentita, se di breve durata, sui dossi", "√à consentita in ogni caso purch√© sia effettuata per la sola salita e discesa dei passeggeri"], correct: 0 },
            { id: "A33", section: "A", number: 33, text: "La fermata √® vietata:", options: ["In corrispondenza dei passaggi a livello", "Sulle strade che non siano suddivise in corsie", "A meno di 15 metri dal segnale di fermata degli autobus"], correct: 0 },
            { id: "A37", section: "A", number: 37, text: "La fermata del veicolo per la semplice salita e discesa dei passeggeri √® sempre vietata:", options: ["In seconda fila", "Sui passaggi od attraversamenti pedonali", "Lungo il margine sinistro di una carreggiata a senso unico di circolazione"], correct: 1 },
            { id: "A45", section: "A", number: 45, text: "Nel rispetto dei limiti di velocit√†, il conducente di un veicolo √® tenuto a regolare la velocit√† in funzione:", options: ["Della potenza del motore", "Della visibilit√†", "Dell'urgenza del trasporto"], correct: 1 },
            { id: "A50", section: "A", number: 50, text: "Su tutte le strade (e loro pertinenze) √® vietato:", options: ["Gettare dai veicoli in movimento qualsiasi cosa", "Usare l'avvisatore acustico (clacson)", "Il transito di veicoli eccezionali"], correct: 0 },
            // Sezione B (primo soccorso)
            { id: "B01", section: "B", number: 1, text: "In caso di evidente emorragia da un arto si deve:", options: ["Impedire assolutamente che il soggetto beva acqua", "Bendare la ferita e far camminare il soggetto per evitare lo shock", "Premere l'arteria tra la ferita e il cuore, se si tratta di emorragia arteriosa"], correct: 2 },
            { id: "B03", section: "B", number: 3, text: "In caso di evidente emorragia da un arto si deve:", options: ["Invitare il soggetto a parlare continuamente per mantenere intatto lo stato di coscienza", "Impedire assolutamente che il soggetto beva acqua", "Tamponare mediante compressione, possibilmente con materiale sterile, la fuoriuscita di sangue"], correct: 2 },
            { id: "B08", section: "B", number: 8, text: "Se la vittima di un incidente presenta un arto fratturato:", options: ["Dopo aver immobilizzato l'arto, attuare le comuni misure anti-shock", "Somministrare al ferito una bevanda super alcolica", "In attesa dell'ambulanza, mantenere vigile la vittima per evitare lo shock"], correct: 0 },
            { id: "B11", section: "B", number: 11, text: "Se si ha il sospetto che la vittima di un incidente stradale abbia riportato una frattura delle ossa del cranio si deve:", options: ["Palpare con accortezza la testa del soggetto per individuare eventuali fratture", "Immobilizzare la testa con steccature od un collare", "Se non respira, praticare la respirazione artificiale dopo aver liberato le vie respiratorie"], correct: 2 },
            { id: "B16", section: "B", number: 16, text: "Le manifestazioni principali dello stato di shock sono:", options: ["Colorito roseo, polso regolare ma stato di incoscienza", "Movimento senza coordinazione degli arti superiori ed inferiori, che risultino freddi e rigidi", "Stato di agitazione, pallore marcato, polso debole e frequente"], correct: 2 },
            { id: "B23", section: "B", number: 23, text: "Lo stato di shock:", options: ["Pu√≤ essere causato da un forte aumento di pressione arteriosa", "Pu√≤ essere causato da una forte perdita di sangue", "Pu√≤ essere causato da violente vertigini"], correct: 1 },
            { id: "B25", section: "B", number: 25, text: "Qualora l'infortunato presenti uno stato di shock, si deve:", options: ["Far sedere il soggetto con la testa reclinata all'indietro, per favorire la respirazione", "Porre il soggetto con gli arti distesi", "Stendere il soggetto supino, coprirlo con una coperta e tenere sollevati gli arti inferiori"], correct: 2 },
            { id: "B34", section: "B", number: 34, text: "Se la vittima di un incidente presenta un corpo estraneo in un occhio si deve:", options: ["Cercare a tutti i costi di rimuoverlo, per evitare infezioni", "Evitare sfregamenti da parte della vittima sull'occhio, per evitare l'aggravamento della lesione", "Porre la vittima a testa in gi√π, per facilitare la fuoriuscita spontanea del corpo estraneo"], correct: 1 },
            { id: "B40", section: "B", number: 40, text: "Se a seguito d'incendio, l'infortunato presenta gli abiti in fiamme, si deve:", options: ["Aspettare che si spengano e poi coprire le ustioni", "Estinguere le fiamme in ogni caso, anche con un estintore", "Soffocare le fiamme allo scopo di spegnerle"], correct: 2 },
            // Sezione C (assicurazione, geografia, economia)
            { id: "C01", section: "C", number: 1, text: "La 'Legenda' sulle Carte Geografiche, cosa indica?", options: ["Spiega i segni convenzionali", "Indica la storia delle localit√†", "Specifica i ristoranti tipici"], correct: 0 },
            { id: "C04", section: "C", number: 4, text: "Qual √® il porto pubblico passeggeri civile che unisce il Lazio alla Sardegna?", options: ["Gaeta", "Civitavecchia", "Anzio"], correct: 1 },
            { id: "C08", section: "C", number: 8, text: "Qual √® la formula assicurativa RCA che premia l‚Äôassicurato che nel corso dell‚Äôanno non ha provocato danni a terzi?", options: ["Bonus ‚Äì Malus", "A franchigia fissa", "A contrattazione diretta"], correct: 0 },
            { id: "C12", section: "C", number: 12, text: "La licenza taxi pu√≤ essere attribuita:", options: ["A seguito di bando pubblico concorso esperito dal Comune", "A seguito di bando pubblico concorso esperito dalla Regione", "Facendone regolare domanda al Sindaco del Comune di residenza"], correct: 0 },
            { id: "C16", section: "C", number: 16, text: "L'assicurazione per la responsabilit√† civile auto (RCA), obbligatoria per legge, comprende:", options: ["Il risarcimento dei danni provocati dal veicolo, solo se guidato dal proprietario", "L'incendio, il furto e il danno a terzi entro i massimali", "Il risarcimento dei danni provocati a terzi trasportati entro i massimali"], correct: 2 },
            { id: "C24", section: "C", number: 24, text: "La polizza di assicurazione per la responsabilit√† civile auto (RCA) copre:", options: ["Ogni forma di responsabilit√†, in proporzione al premio pagato", "I rischi che gravano sul conducente, ma non sul proprietario del veicolo", "La responsabilit√† per i sinistri occorsi anche nei paesi dell‚ÄôUnione Europea"], correct: 2 },
            { id: "C41", section: "C", number: 41, text: "Roma √® collegata a Rieti dalla?", options: ["Via Casilina", "Via Prenestina", "Via Salaria"], correct: 2 },
            { id: "C52", section: "C", number: 52, text: "Il titolare di una licenza per l‚Äôesercizio del servizio di taxi pu√≤ chiedere di trasferirla a terzi, in possesso dei requisiti fissati dalla Legge, quando si trovi in una delle seguenti condizioni:", options: ["Sia titolare della licenza da almeno 5 anni", "Sia titolare della licenza da almeno 6 anni", "Sia titolare della licenza da almeno 10 anni"], correct: 0 },
            { id: "C63", section: "C", number: 63, text: "Roma √® collegata a Viterbo dalla:", options: ["Via Flaminia", "Via Cassia", "Via Salaria"], correct: 1 },
            { id: "C76", section: "C", number: 76, text: "Quali sono i principali elementi coperti da un'assicurazione RCA auto?", options: ["Danneggiamento del veicolo assicurato", "Responsabilit√† civile verso terzi", "Furto del veicolo"], correct: 1 },
            // Sezione D (diritto)
            { id: "D01", section: "D", number: 1, text: "Come si definisce 'l‚Äôaccordo di due o pi√π parti per costituire, regolare od estinguere un rapporto giuridico-patrimoniale'?", options: ["Trattativa", "Contratto", "Clausola"], correct: 1 },
            { id: "D08", section: "D", number: 8, text: "In un contratto, quali sono le norme che regolano la formazione degli atti negoziali in generale?", options: ["Quelle dettate dalla volont√† delle parti contraenti", "Quelle dettate dal Codice Penale", "Quelle dettate dal Codice Civile"], correct: 2 },
            { id: "D17", section: "D", number: 17, text: "Il negozio giuridico con cui due o pi√π parti conferiscono beni e/o servizi, per il comune esercizio di un‚Äôattivit√† economica, come si definisce?", options: ["Societ√†", "Contratto", "Cooperazione"], correct: 0 },
            { id: "D24", section: "D", number: 24, text: "In quale di questi tre tipi di societ√† pu√≤ essere esercitata l‚Äôattivit√† di tassista?", options: ["Societ√† cooperativa", "Societ√† in nome collettivo", "Societ√† a responsabilit√† limitata"], correct: 0 },
            { id: "D28", section: "D", number: 28, text: "In quale tipo di societ√† √® prevista la responsabilit√† illimitata e solidale dei soci per le obbligazioni assunte dalla stessa?", options: ["Societ√† a responsabilit√† limitata", "Societ√† per Azioni", "Societ√† in nome collettivo"], correct: 2 },
            { id: "D49", section: "D", number: 49, text: "La Societ√† in nome collettivo √® una societ√†:", options: ["Di persone", "Di capitali", "A scopo mutualistico"], correct: 0 },
            { id: "D61", section: "D", number: 61, text: "Che cos‚Äô√® una cambiale?", options: ["√à un titolo che attribuisce al possessore legittimo il diritto incondizionato di pretendere il pagamento di una somma determinata alla scadenza indicata", "√à un titolo che attribuisce al possessore legittimo il diritto condizionato di pretendere il pagamento di una somma determinata alla scadenza indicata", "√à un titolo che attribuisce al possessore legittimo il pagamento di una somma determinata quando il debitore avr√† la possibilit√†"], correct: 0 },
            { id: "D70", section: "D", number: 70, text: "Che cosa vuol dire IVA?", options: ["Imposta Versamento Acquisti", "Imposta Volume Affari", "Imposta Valore Aggiunto"], correct: 2 },
            // Sezione D bis (toponomastica Roma)
            { id: "Dbis01", section: "D bis", number: 1, text: "Dov‚Äô√® il teatro di Roma?", options: ["Piazza Cavour", "Largo Argentina", "Via Sistina"], correct: 1 },
            { id: "Dbis02", section: "D bis", number: 2, text: "Il Ministero dell‚ÄôEconomia e delle Finanze nella citt√† di Roma √® situato in:", options: ["Via XX Settembre", "Piazza San Bernardo", "Piazza Cavour"], correct: 0 },
            { id: "Dbis08", section: "D bis", number: 8, text: "Dove ha sede il Consiglio Superiore della Magistratura?", options: ["Piazza della Libert√†", "Piazza Indipendenza", "Via Benevento"], correct: 1 },
            { id: "Dbis12", section: "D bis", number: 12, text: "Qual √® l‚ÄôOspedale pi√π vicino alla Basilica di San Pietro?", options: ["Forlanini", "Cristo Re", "Santo Spirito"], correct: 2 },
            { id: "Dbis17", section: "D bis", number: 17, text: "Dove ha sede il Ministero dell‚ÄôInterno?", options: ["Palazzo del Viminale", "Palazzo Barberini", "Palazzo Venezia"], correct: 0 },
            { id: "Dbis23", section: "D bis", number: 23, text: "Quale Strada inizia da Porta Pia?", options: ["Via Tuscolana", "Via Nomentana", "Via Salaria"], correct: 1 },
            { id: "Dbis28", section: "D bis", number: 28, text: "La Scala Santa si trova:", options: ["Piazza di Santa Maria Maggiore", "Piazza San Pietro", "Piazza di San Giovanni in Laterano"], correct: 2 },
            { id: "Dbis35", section: "D bis", number: 35, text: "In quale via ha sede l‚ÄôAmbasciata degli Stati Uniti d‚ÄôAmerica presso lo Stato italiano?", options: ["Viale J.F. Kennedy", "Viale Trastevere", "Via Vittorio Veneto"], correct: 2 },
            { id: "Dbis48", section: "D bis", number: 48, text: "Dov‚Äô√® ubicata la sede del Senato della Repubblica?", options: ["Piazza Madama", "Piazza Montecitorio", "Piazza del Parlamento"], correct: 0 },
            { id: "Dbis57", section: "D bis", number: 57, text: "Dov‚Äô√® Ubicata la sede della Camera dei Deputati?", options: ["Piazza Madama", "Piazza Montecitorio", "Piazza Fiume"], correct: 1 },
            { id: "Dbis64", section: "D bis", number: 64, text: "Per raggiungere Anzio, da Roma, si percorre:", options: ["Via Salaria", "Via Flaminia", "Via Pontina"], correct: 2 },
            { id: "Dbis71", section: "D bis", number: 71, text: "A Roma dov‚Äô√® ubicato l‚ÄôOspedale ‚ÄúPoliclinico Universitario A. Gemelli‚Äù?", options: ["Viale del Policlinico", "Via Trionfale", "Via della Pineta Sacchetti"], correct: 2 },
            { id: "Dbis85", section: "D bis", number: 85, text: "Dov‚Äô√® ubicato, a Roma, l‚ÄôOspedale ‚ÄúSandro Pertini‚Äù?", options: ["Viale Trastevere", "Via Arenula", "Via dei Monti Tiburtini"], correct: 2 },
            { id: "Dbis90", section: "D bis", number: 90, text: "Dov‚Äô√® ubicato, a Roma, l‚ÄôOspedale ‚ÄúFatebenefratelli Villa S. Pietro‚Äù?", options: ["Via Tiburtina", "Via Cassia", "Via Aurelia"], correct: 2 },
            { id: "Dbis97", section: "D bis", number: 97, text: "Quale √® il percorso pi√π breve, tra quelli proposti, per andare dalla Stazione Tiburtina agli Studi di Cinecitt√†?", options: ["Viale A. Spinelli, Via Tiburtina, Viale della Primavera, Viale Palmiro Togliatti, Via S. Ottato, Cinecitt√† Studios", "Via Tiburtina ‚Äì Raccordo Anulare ‚Äì Via Tuscolana ‚Äì Stabilimenti di Cinecitt√†", "Tangenziale ‚Äì Viale Castrense - Piazzale Appio ‚Äì Via Appia ‚Äì Via Tuscolana ‚Äì Stabilimenti di Cinecitt√†"], correct: 0 }
        ];

        // --- SHUFFLE: mescola l'array delle domande (Fisher‚ÄëYates) ---
        function shuffleArray(arr) {
            for (let i = arr.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [arr[i], arr[j]] = [arr[j], arr[i]];
            }
            return arr;
        }

        // Mescola le domande all'avvio
        let questions = shuffleArray([...baseQuestions]);

        // ------------------- USER MANAGEMENT (localStorage) -------------------
        const STORAGE_KEY = 'quizUsers';
        function getUsers() {
            const stored = localStorage.getItem(STORAGE_KEY);
            return stored ? JSON.parse(stored) : [];
        }
        function saveUsers(users) {
            localStorage.setItem(STORAGE_KEY, JSON.stringify(users));
        }

        // ------------------- PAGES -------------------
        const coverPage = document.getElementById('cover-page');
        const authPage = document.getElementById('auth-page');
        const quizPage = document.getElementById('quiz-page');

        const toggleLoginBtn = document.getElementById('toggle-login');
        const toggleRegisterBtn = document.getElementById('toggle-register');
        const loginPanel = document.getElementById('login-panel');
        const registerPanel = document.getElementById('register-panel');

        const loginUsername = document.getElementById('login-username');
        const loginPassword = document.getElementById('login-password');
        const loginMessage = document.getElementById('login-message');
        const regUsername = document.getElementById('reg-username');
        const regPassword = document.getElementById('reg-password');
        const registerMessage = document.getElementById('register-message');

        const goToAuthBtn = document.getElementById('go-to-auth-btn');
        const backFromLogin = document.getElementById('back-from-login');
        const backFromRegister = document.getElementById('back-from-register');
        const loginBtn = document.getElementById('login-btn');
        const registerBtn = document.getElementById('register-btn');
        const logoutBtn = document.getElementById('logout-btn');

        function showPage(page) {
            coverPage.classList.add('hidden');
            authPage.classList.add('hidden');
            quizPage.classList.add('hidden');
            if (page === 'cover') coverPage.classList.remove('hidden');
            else if (page === 'auth') authPage.classList.remove('hidden');
            else if (page === 'quiz') quizPage.classList.remove('hidden');
        }

        goToAuthBtn.addEventListener('click', () => {
            showPage('auth');
            resetAuthForms();
        });

        function resetAuthForms() {
            loginUsername.value = '';
            loginPassword.value = '';
            regUsername.value = '';
            regPassword.value = '';
            loginMessage.textContent = '';
            registerMessage.textContent = '';
        }

        backFromLogin.addEventListener('click', () => showPage('cover'));
        backFromRegister.addEventListener('click', () => showPage('cover'));

        toggleLoginBtn.addEventListener('click', () => {
            toggleLoginBtn.classList.add('active');
            toggleRegisterBtn.classList.remove('active');
            loginPanel.classList.add('active');
            registerPanel.classList.remove('active');
        });
        toggleRegisterBtn.addEventListener('click', () => {
            toggleRegisterBtn.classList.add('active');
            toggleLoginBtn.classList.remove('active');
            registerPanel.classList.add('active');
            loginPanel.classList.remove('active');
        });

        registerBtn.addEventListener('click', (e) => {
            e.preventDefault();
            const username = regUsername.value.trim();
            const password = regPassword.value.trim();
            if (!username || !password) {
                registerMessage.textContent = '‚ùå Inserisci username e password';
                return;
            }
            const users = getUsers();
            if (users.some(u => u.username === username)) {
                registerMessage.textContent = '‚ùå Username gi√† esistente';
                return;
            }
            users.push({ username, password });
            saveUsers(users);
            registerMessage.style.color = '#1f7a4c';
            registerMessage.textContent = '‚úÖ Registrazione completata! Ora puoi accedere.';
            loginUsername.value = username;
            loginPassword.value = password;
            toggleLoginBtn.click();
        });

        loginBtn.addEventListener('click', (e) => {
            e.preventDefault();
            const username = loginUsername.value.trim();
            const password = loginPassword.value.trim();
            if (!username || !password) {
                loginMessage.textContent = '‚ùå Inserisci username e password';
                return;
            }
            const users = getUsers();
            const user = users.find(u => u.username === username && u.password === password);
            if (user) {
                loginMessage.textContent = '';
                showPage('quiz');
                renderQuestion();
                updateStatsMessage();
            } else {
                loginMessage.textContent = '‚ùå Username o password errati';
            }
        });

        logoutBtn.addEventListener('click', () => {
            showPage('cover');
            if (confirm('Vuoi anche azzerare i progressi del quiz?')) {
                resetQuizData();
                renderQuestion();
                updateStatsMessage();
            }
        });

        // ------------------- QUIZ LOGIC -------------------
        let currentIndex = 0;
        let userAnswers = new Array(questions.length).fill(null);
        let answeredStatus = new Array(questions.length).fill(false);
        let score = 0;

        const totalQuestions = questions.length;
        document.getElementById('total-q-count').textContent = totalQuestions;
        updateScoreDisplay();

        const qCodeEl = document.getElementById('q-code');
        const qTextEl = document.getElementById('q-text');
        const optionsContainer = document.getElementById('options-container');
        const feedbackArea = document.getElementById('feedback-area');
        const prevBtn = document.getElementById('prevBtn');
        const nextBtn = document.getElementById('nextBtn');
        const checkBtn = document.getElementById('checkBtn');
        const resetBtn = document.getElementById('resetBtn');
        const statsMsg = document.getElementById('stats-message');
        const currentQNumSpan = document.getElementById('current-q-num');

        function renderQuestion() {
            const q = questions[currentIndex];
            qCodeEl.textContent = `${q.section} ${q.number.toString().padStart(2,'0')}`;
            qTextEl.textContent = q.text;

            let htmlStr = '';
            for (let i = 0; i < q.options.length; i++) {
                let classes = 'option';
                if (userAnswers[currentIndex] === i) classes += ' selected';
                if (answeredStatus[currentIndex]) {
                    if (i === q.correct) classes += ' correct-answer';
                    else if (userAnswers[currentIndex] === i && userAnswers[currentIndex] !== q.correct) classes += ' wrong-answer';
                }
                htmlStr += `<div class="${classes}" data-opt-index="${i}">${i+1}. ${q.options[i]}</div>`;
            }
            optionsContainer.innerHTML = htmlStr;

            document.querySelectorAll('.option').forEach(optDiv => {
                optDiv.addEventListener('click', () => {
                    if (answeredStatus[currentIndex]) return;
                    const idx = parseInt(optDiv.dataset.optIndex, 10);
                    userAnswers[currentIndex] = idx;
                    renderQuestion();
                });
            });

            if (answeredStatus[currentIndex]) {
                const selected = userAnswers[currentIndex];
                if (selected === null) {
                    feedbackArea.textContent = '‚ö†Ô∏è Non avevi selezionato una risposta prima di verificare.';
                } else {
                    const isCorrect = (selected === q.correct);
                    feedbackArea.innerHTML = isCorrect
                        ? '‚úÖ Risposta corretta!'
                        : `‚ùå Risposta sbagliata. Quella corretta era: ${q.correct+1}. ${q.options[q.correct]}`;
                }
            } else {
                feedbackArea.innerHTML = '';
            }

            currentQNumSpan.textContent = currentIndex + 1;
            prevBtn.disabled = (currentIndex === 0);
            nextBtn.disabled = (currentIndex === totalQuestions - 1);
            updateStatsMessage();
        }

        function updateStatsMessage() {
            const answeredCount = answeredStatus.filter(v => v).length;
            statsMsg.innerHTML = `üìä Verificate: ${answeredCount}/${totalQuestions} ¬∑ Punteggio: ${score}`;
        }

        function updateScoreDisplay() {
            document.getElementById('score-display').textContent = `‚úÖ ${score} / ${totalQuestions}`;
        }

        function checkCurrent() {
            if (answeredStatus[currentIndex]) {
                alert('Hai gi√† verificato questa domanda. Passa alla successiva.');
                return;
            }
            const selected = userAnswers[currentIndex];
            if (selected === null) {
                alert('Seleziona una risposta prima di verificare.');
                return;
            }
            const q = questions[currentIndex];
            if (selected === q.correct) score++;
            answeredStatus[currentIndex] = true;
            updateScoreDisplay();
            renderQuestion();
            updateStatsMessage();
        }

        function goPrev() { if (currentIndex > 0) { currentIndex--; renderQuestion(); } }
        function goNext() { if (currentIndex < totalQuestions - 1) { currentIndex++; renderQuestion(); } }

        function resetQuizData() {
            userAnswers = new Array(questions.length).fill(null);
            answeredStatus = new Array(questions.length).fill(false);
            score = 0;
            currentIndex = 0;
            updateScoreDisplay();
            renderQuestion();
            updateStatsMessage();
        }

        prevBtn.addEventListener('click', goPrev);
        nextBtn.addEventListener('click', goNext);
        checkBtn.addEventListener('click', checkCurrent);
        resetBtn.addEventListener('click', () => { if (confirm('Ricominciare il quiz?')) resetQuizData(); });

        renderQuestion();
        updateStatsMessage();
        showPage('cover');
    })();
</script>
</body>
</html>
